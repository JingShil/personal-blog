{"version":3,"file":"static/js/973.ef5265d0.js","mappings":"0RAEO,SAASA,EAAMC,GACrB,OAAOC,EAAAA,EAAAA,GAAQ,CACdC,IAAI,cACJC,OAAO,OACPC,KAAKJ,GAEP,CAUO,SAASK,EAAKL,GACpB,OAAOC,EAAAA,EAAAA,GAAQ,CACdC,IAAI,aACJC,OAAO,OACPC,KAAKJ,GAEP,CAEO,SAASM,EAASC,GACxB,OAAON,EAAAA,EAAAA,GAAQ,CACdC,IAAI,wBACJC,OAAO,MACPK,OAAO,CACND,YAEDE,aAAc,QAEhB,CAEO,SAASC,IACf,OAAOT,EAAAA,EAAAA,GAAQ,CACdC,IAAI,aACJC,OAAO,OAET,CAEO,SAASQ,IACf,OAAOV,EAAAA,EAAAA,GAAQ,CACdC,IAAI,mBACJC,OAAO,OAET,CAEO,SAASS,EAAmBC,GAClC,OAAOZ,EAAAA,EAAAA,GAAQ,CACdC,IAAI,qBACJC,OAAO,MACPK,OAAO,CACNK,cAGH,C,0WCzDO,SAASC,EAAeD,EAAUE,EAAYC,GACpD,OAAOf,EAAAA,EAAAA,GAAQ,CACdC,IAAI,eACJC,OAAO,MACPK,OAAO,CACNK,YAAUE,aAAYC,aAGzB,CAEO,SAASC,EAAWC,GAC1B,OAAOjB,EAAAA,EAAAA,GAAQ,CACdC,IAAI,uBACJC,OAAO,OACPC,KAAKc,GAEP,CAEO,SAASC,EAASC,GACxB,OAAOnB,EAAAA,EAAAA,GAAQ,CACdC,IAAI,qBACJC,OAAO,OACPC,KAAKgB,GAEP,C,+7CC6DcC,EAAAA,EAAAA,KAAI,GAClB,MAAMC,GAAQC,EAAAA,EAAAA,MACd,IAAIV,EAAUS,EAAME,MAAMX,UAEtBY,GAAYJ,EAAAA,EAAAA,IAAI,MAChBK,GAAQL,EAAAA,EAAAA,IAAI,GACZM,EAAWC,KAAKC,MAAMC,aAAaC,QAAQ,aAC3CC,GAAQX,EAAAA,EAAAA,KAAI,GACZY,EAAgB,KAChBC,EAAc,KACdC,GAAad,EAAAA,EAAAA,IAAI,IACjBe,GAAWf,EAAAA,EAAAA,IAAI,IACfgB,EAAS,IACb,MAAMC,GAAcC,EAAAA,EAAAA,IAAO,qBAU3B,SAASC,EAAYzB,EAAYC,GAChCF,EAAeD,EAAUE,EAAYC,GACnCyB,MAAKC,IACQ,MAAVA,EAAItC,OAIPsB,EAAMiB,MAAMD,EAAItC,KAAKsB,MACrBD,EAAYkB,MAAMD,EAAItC,KAAKwC,QAC3BnB,EAAYkB,MAAME,SAAQ3B,IAEzB4B,OAAOC,OAAO7B,EAAS,CAAE8B,SAAS,IAE9B9B,EAAQ+B,cACX/B,EAAQ+B,aAAaJ,SAAQzB,IAC5B0B,OAAOC,OAAO3B,EAAO,CAAE4B,SAAS,GAAQ,GAE1C,IACC,GAIL,CAEA,SAASE,EAAmBhC,EAASmB,GACpC,MAAMc,EAAgBjC,EAAQ+B,aAAaG,MAAKC,GAAYA,EAASjC,MAAMkC,KAAOjB,IAClF,OAAOc,EAAgBA,EAAcI,SAAW,EACjD,CAEA,SAASC,EAAUC,GAIE,MAAjBxB,IACgB,MAAfC,EACFwB,IAEAC,KAIFtB,EAAS,IACTD,EAAWO,MAAM,GACjBV,EAAgBwB,EAChBhC,EAAYkB,MAAMS,MAAKlC,GAASA,EAAQ0C,WAAW1C,QAAQoC,KAAKG,IAAWT,SAAQ,CAIpF,CAEA,SAASW,IAERlC,EAAYkB,MAAMS,MAAKlC,GAASA,EAAQ0C,WAAW1C,QAAQoC,KAAKrB,IAAiBe,SAAQ,EACzFf,EAAgB,IAGjB,CAEA,SAAS4B,EAAQJ,EAAUK,GAC1B1B,EAAWO,MAAM,GACG,MAAjBV,IACgB,MAAfC,EACFwB,IAEAC,KAIFtB,EAASyB,EACT7B,EAAgBwB,EAChBvB,EAAc4B,EACdrC,EAAYkB,MAAMS,MAAKlC,GAASA,EAAQ0C,WAAW1C,QAAQoC,KAAKG,IAAWR,aAAaG,MAAKC,GAAUA,EAASjC,MAAMkC,KAAKQ,IAASd,SAAQ,CAE7I,CAEA,SAASU,IAGRjC,EAAYkB,MAAMS,MAAKlC,GAASA,EAAQ0C,WAAW1C,QAAQoC,KAAKrB,IAAiBgB,aAAaG,MAAKC,GAAUA,EAASjC,MAAMkC,KAAKpB,IAAec,SAAQ,EACxJd,EAAc,KACdD,EAAgB,IACjB,CACA,SAAS8B,IACR,IAAIC,EAAK,CACR,UAAYnD,EACZ,OAASc,EAAS2B,GAClB,QAAUnB,EAAaQ,OAExB1B,EAAW+C,GACVvB,MAAKC,KACLuB,EAAAA,EAAAA,IAAU,CACTC,QAAS,OACTC,KAAM,YAEP3B,EAAY,EAAE,EAAE,GAElB,CAEA,SAAS4B,EAASX,GACjB,IAAIY,EAAK,CACR,UAAYZ,EACZ,OAAS9B,EAAS2B,GAClB,SAAWjB,EACX,QAAUD,EAAWO,OAEtBxB,EAASkD,GACR5B,MAAKC,KACLuB,EAAAA,EAAAA,IAAU,CACTC,QAAS,OACTC,KAAM,YAEP3B,EAAY,EAAE,EAAE,GAElB,C,OAzHA8B,EAAAA,EAAAA,KAAU,KACT9B,EAAY,EAAE,GACD,MAAVb,IACFK,EAAQW,OAAM,EAEf,I,irFCrGD,MAAM4B,IAA2B,QAAgB,GAAQ,CAAC,CAAC,YAAY,qBAEvE,U,ikDCsFA,MAAMjD,GAAQC,EAAAA,EAAAA,MACRiD,GAAWnD,EAAAA,EAAAA,IAAI,GAEfiB,IADSjB,EAAAA,EAAAA,OACKkB,EAAAA,EAAAA,IAAO,sBAE3B,IAAI1B,EAAU,KACV4D,GAAiBpD,EAAAA,EAAAA,IAAI,IACrBqD,GAAWrD,EAAAA,EAAAA,IAAI,IAEfsD,IADOtD,EAAAA,EAAAA,IAAI,KACHA,EAAAA,EAAAA,IAAI,CACd,GAAM,KACN,OAAU,IACV,MAAS,GACT,QAAW,GACX,UAAa,KACb,QAAW,KACX,WAAc,KACd,QAAU,KACV,WAAc,KACd,WAAc,KACd,WAAc,QAEZuD,GAAUvD,EAAAA,EAAAA,IAAI,CACjB,KAAO,KACP,SAAW,KACX,OAAS,KACT,IAAM,KACN,SAAW,KACX,QAAU,OAEPwD,GAAWxD,EAAAA,EAAAA,IAAI,OACRA,EAAAA,EAAAA,OACCA,EAAAA,EAAAA,KAAI,GAoBhB,SAASyD,IACP,IAAIC,EAAUL,EAAS/B,MACpBqC,EAAEN,EAAS/B,MAAMsC,OAAO,EACxBC,EAAK,EACT,IAAIF,EAAEA,GAAG,EAAEA,IACPD,EAAQC,GAAGG,WAAWC,OAAOC,SAAiB,GAANH,GAC1CV,EAAS7B,MAAM2C,SACRF,OAAOC,QAAUE,SAASC,gBAAgBC,aACzC,KACA,IACRP,EAAK,EACLH,EAAQC,GAAGU,MAAM,2DAEjBX,EAAQC,GAAGU,MAAM,6CAGpB,CAgBA,SAASC,KAEPhF,EAAAA,EAAAA,MACC8B,MAAKC,IACJkC,EAAUjC,MAAMD,EAAItC,IAAI,GAI5B,CAEA,SAASwF,KAERhF,EAAAA,EAAAA,IAAmB+D,EAAQhC,MAAMkD,QAC/BpD,MAAKC,IACLmC,EAAWlC,MAAMD,EAAItC,IAAI,GAE5B,CAcA,SAAS0F,IAEO,MAAXjF,IACDkF,EAAAA,EAAAA,IAAclF,GACb4B,MAAKC,IAEJ+B,EAAe9B,MAAMD,EAAItC,KAAK4F,QAE9BrB,EAAQhC,MAAMD,EAAItC,KAAKuE,QAC1B,MAAMsB,EAAaV,SAASW,eAAe,UAC3CC,IAAAA,QAAeF,EAAWtB,EAAQhC,MAAMyD,QAAQ,CAC/CC,KAAK,CAACC,MAAM,SACZC,KAAAA,GACCC,GACD,IAEDZ,GAAgB,GAKnB,CAGA,SAASY,IACP,IAAIC,EAAKlB,SAASW,eAAe,UAClC,MAAMQ,EAAW,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MAChD,IAAIC,EAAO,GAENC,EAAM,EAIVH,EAAGI,WAAWhE,SAAQ,CAACiE,EAAGC,KACxB,GAAIL,EAASM,SAASF,EAAEG,UAAW,CAEpC,IAAI3D,EAAK,MAAQyD,EACjBN,EAAGI,WAAWE,GAAOzD,GAAKA,EACvBsD,EAAMM,OAAOJ,EAAEG,SAASE,UAAU,EAAG,IAQrCR,EAAOS,KAAK,CACV9D,GAAIA,EACJ+D,MAAOP,EAAEQ,UACTC,MAAOX,EACPK,SAAUH,EAAEG,SAChB9B,UAAW2B,EAAEU,UACb9B,MAAM,+CAEN,KAEHhB,EAAS/B,MAAMgE,CAGhB,CAGA,SAASc,EAAUC,GAEjB,MAAMC,EAAUpC,SAASW,eAAewB,GACpCC,IACFC,QAAQC,IAAIH,GACZC,EAAQG,eAAe,CAAEC,SAAU,YAEvC,C,OAtJ4B,MAAzBzG,EAAME,MAAMX,YAEbA,EAAUS,EAAME,MAAMX,YAIxByD,EAAAA,EAAAA,KAAU,KAETqB,IACgB,MAAb9E,GACHiF,IACAV,OAAO4C,iBAAiB,SAAUlD,GAAa,EAAK,KAIrDmD,EAAAA,EAAAA,KAAgB,KACf7C,OAAO8C,oBAAoB,SAAUpD,EAAa,I,sjDCzInD,MAAM,IAA2B,QAAgB,GAAQ,CAAC,CAAC,YAAY,qBAEvE,S","sources":["webpack://blog-front/./src/api/user.js","webpack://blog-front/./src/api/comment.js","webpack://blog-front/./src/views/comment/Index.vue","webpack://blog-front/./src/views/comment/Index.vue?9327","webpack://blog-front/./src/views/blog/Index.vue","webpack://blog-front/./src/views/blog/Index.vue?4373"],"sourcesContent":["import request from '@/utils/request.js'\r\n\r\nexport function login(user){\r\n\treturn request({\r\n\t\turl:'/user/login',\r\n\t\tmethod:'post',\r\n\t\tdata:user\r\n\t})\r\n}\r\n\r\nexport function register(user){\r\n\treturn request({\r\n\t\turl:'/user/register',\r\n\t\tmethod:'post',\r\n\t\tdata:user\r\n\t})\r\n}\r\n\r\nexport function save(user){\r\n\treturn request({\r\n\t\turl:'/user/save',\r\n\t\tmethod:'post',\r\n\t\tdata:user\r\n\t})\r\n}\r\n\r\nexport function download(filePath){\r\n\treturn request({\r\n\t\turl:'/user/download/avatar',\r\n\t\tmethod:'get',\r\n\t\tparams:{\r\n\t\t\tfilePath\r\n\t\t},\r\n\t\tresponseType: 'blob'\r\n\t})\r\n}\r\n\r\nexport function getUserInfo(){\r\n\treturn request({\r\n\t\turl:'/user/info',\r\n\t\tmethod:'get'\r\n\t})\r\n}\r\n\r\nexport function getAdminUserInfo(){\r\n\treturn request({\r\n\t\turl:'/user/admin/info',\r\n\t\tmethod:'get'\r\n\t})\r\n}\r\n\r\nexport function getArticleUserInfo(articleId){\r\n\treturn request({\r\n\t\turl:'/user/article/info',\r\n\t\tmethod:'get',\r\n\t\tparams:{\r\n\t\t\tarticleId\r\n\t\t}\r\n\t})\r\n}","import request from '@/utils/request'\r\n\r\nexport function getCommentList(articleId,pageNumber, pageSize){\r\n\treturn request({\r\n\t\turl:'/comment/get',\r\n\t\tmethod:'get',\r\n\t\tparams:{\r\n\t\t\tarticleId,pageNumber, pageSize\r\n\t\t}\r\n\t})\r\n}\r\n\r\nexport function addComment(comment){\r\n\treturn request({\r\n\t\turl:'/comment/add/comment',\r\n\t\tmethod:'post',\r\n\t\tdata:comment\r\n\t})\r\n}\r\n\r\nexport function addReply(reply){\r\n\treturn request({\r\n\t\turl:'/comment/add/reply',\r\n\t\tmethod:'post',\r\n\t\tdata:reply\r\n\t})\r\n}","<template>\r\n\t<div class=\"comment-body\" v-if=\"isLogin\">\r\n\t\t<div class=\"comment-head\">\r\n\t\t\t<div class=\"comment-input\">\r\n\t\t\t\t<!-- <img class=\"comment-user-avatar\" src=\"@/assets/imgs/fufu.jpg\" style=\"margin-right: 5px;\"> -->\r\n\t\t\t\t<img class=\"comment-user-avatar\" :src=\"imgDownload + userInfo.avatar\" style=\"margin-right: 5px;\">\r\n\t\t\t\t<textarea v-model=\"commentInput\" maxlength=\"1000\"></textarea>\r\n\t\t\t\t<div class=\"comment-input-button\"  @click=\"setComment()\">评论</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"comment-main\">\r\n\t\t\t<div class=\"comment-for\" v-for=\"comment in commentList\" :key=\"comment.commentDto.comment.id\">\r\n\t\t\t\t<div class=\"comment\">\r\n\t\t\t\t\t<div class=\"comment-content\">\r\n\t\t\t\t\t\t<div class=\"comment-content-left\">\r\n\t\t\t\t\t\t\t<img class=\"comment-user-avatar\" :src=\"imgDownload + comment.commentDto.userAvatar\">\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"comment-content-right\">\r\n\t\t\t\t\t\t\t<div class=\"comment-user-name\">{{ comment.commentDto.userName }}</div>\r\n\t\t\t\t\t\t\t<div class=\"comment-time\">{{ comment.commentDto.comment.createTime }}</div>\r\n\t\t\t\t\t\t\t<div class=\"comment-text\">{{ comment.commentDto.comment.content }}</div>\r\n\t\t\t\t\t\t\t<div class=\"comment-info\">\r\n\t\t\t\t\t\t\t\t<div class=\"comment-info-item\" v-if=\"!comment.isReply\" @click=\"toComment(comment.commentDto.comment.id)\">\r\n\t\t\t\t\t\t\t\t\t<img src=\"@/assets/imgs/blog/评论.svg\">\r\n\t\t\t\t\t\t\t\t\t<span>回复</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"comment-info-item\" v-else @click=\"cancelComment(comment.commentDto.comment.id)\">\r\n\t\t\t\t\t\t\t\t\t<img src=\"@/assets/imgs/blog/评论.svg\">\r\n\t\t\t\t\t\t\t\t\t<span>收起</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"comment-info-item\">\r\n\t\t\t\t\t\t\t\t\t<span>1</span>\r\n\t\t\t\t\t\t\t\t\t<img src=\"@/assets/imgs/blog/点赞.svg\">\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"comment-input\" style=\"width: 90%;\" v-if=\"comment.isReply\">\r\n\t\t\t\t\t\t<textarea v-model=\"replyInput\" maxlength=\"1000\" style=\"height: 120px;\"></textarea>\r\n\t\t\t\t\t\t<div class=\"comment-input-button\" @click=\"setReply(comment.commentDto.comment.id)\">评论</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"comment-item-for\"  v-for=\"replyDto in comment.replyDtoList\" :key=\"replyDto.reply.id\">\r\n\t\t\t\t\t\t<div class=\"comment-content\">\r\n\t\t\t\t\t\t\t<div class=\"comment-content-left\">\r\n\t\t\t\t\t\t\t\t<img class=\"comment-user-avatar\" :src=\"imgDownload + replyDto.userAvatar\">\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"comment-content-right\">\r\n\t\t\t\t\t\t\t\t<div class=\"comment-user-name\">{{replyDto.userName}}</div>\r\n\t\t\t\t\t\t\t\t<div class=\"comment-time\">{{ replyDto.reply.createTime }}</div>\r\n\t\t\t\t\t\t\t\t<div class=\"comment-text\">\r\n\t\t\t\t\t\t\t\t\t<div v-if=\"replyDto.reply.parentId!='0'\">回复<span>{{ findParentUserName(comment, replyDto.reply.parentId) }}：</span></div>\r\n\t\t\t\t\t\t\t\t\t<div>{{ replyDto.reply.content }}</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"comment-info\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"comment-info-item\" v-if=\"!replyDto.isReply\" @click=\"toReply(comment.commentDto.comment.id,replyDto.reply.id)\">\r\n\t\t\t\t\t\t\t\t\t\t<img src=\"@/assets/imgs/blog/评论.svg\">\r\n\t\t\t\t\t\t\t\t\t\t<span>回复</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"comment-info-item\" v-else @click=\"cancelReply(comment.commentDto.comment.id,replyDto.reply.id)\">\r\n\t\t\t\t\t\t\t\t\t\t<img src=\"@/assets/imgs/blog/评论.svg\">\r\n\t\t\t\t\t\t\t\t\t\t<span>收起</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"comment-info-item\">\r\n\t\t\t\t\t\t\t\t\t\t<span>1</span>\r\n\t\t\t\t\t\t\t\t\t\t<img src=\"@/assets/imgs/blog/点赞.svg\">\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"comment-input\" style=\"width: 90%;\" v-if=\"replyDto.isReply\">\r\n\t\t\t\t\t\t\t<textarea v-model=\"replyInput\" maxlength=\"1000\" style=\"height: 120px;\"></textarea>\r\n\t\t\t\t\t\t\t<div class=\"comment-input-button\" @click=\"setReply(comment.commentDto.comment.id)\">评论</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\nimport {ref,onMounted,inject} from 'vue'\r\nimport {getCommentList,addComment,addReply} from '@/api/comment.js'\r\nimport { useRoute } from 'vue-router';\r\nimport { ElMessage } from 'element-plus'\r\nlet isReply = ref(false);\r\nconst route = useRoute();\r\nlet articleId=route.query.articleId;\r\nlet commentListTemp=null;\r\nlet commentList=ref(null);\r\nlet total = ref(0);\r\nlet userInfo = JSON.parse(localStorage.getItem(\"userInfo\"));\r\nlet isLogin=ref(false);\r\nlet beforeCommentId=null;\r\nlet beforeReplyId=null;\r\nlet commentInput=ref('');\r\nlet replyInput=ref('');\r\nlet parentId=\"0\";\r\nconst imgDownload = inject('globalImgDownload');\r\n\r\nonMounted(()=>{\r\n\tgetComments(1,5);\r\n\tif(userInfo!=null){\r\n\t\tisLogin.value=true;\r\n\t\t// console.log(userInfo);\r\n\t}\r\n})\r\n\r\nfunction getComments(pageNumber, pageSize){\r\n\tgetCommentList(articleId,pageNumber, pageSize)\r\n\t\t.then(res=>{\r\n\t\t\tif(res.data==null){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\ttotal.value=res.data.total;\r\n\t\t\tcommentList.value=res.data.records;\r\n\t\t\tcommentList.value.forEach(comment=>{\r\n\t\t\t\t//为每个对象添加新属性\r\n\t\t\t\tObject.assign(comment, { isReply: false });\r\n\t\t\t\t// 如果replyDtoList不为null，则为每个对象添加新属性\r\n\t\t\t\tif (comment.replyDtoList) {\r\n\t\t\t\t\tcomment.replyDtoList.forEach(reply => {\r\n\t\t\t\t\t\tObject.assign(reply, { isReply: false });\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t// commentListTemp=[...commentList.value];\r\n\t\t\t\r\n\t\t})\r\n}\r\n\r\nfunction findParentUserName(comment, parentId) {\r\n\tconst parentComment = comment.replyDtoList.find(replyDto => replyDto.reply.id === parentId);\r\n\treturn parentComment ? parentComment.userName : '';\r\n}\r\n\r\nfunction toComment(commentId){\r\n\t// commentList.value=commentListTemp;\r\n\t// console.log(commentListTemp)\r\n\t// commentList.value=Object.assign([], commentListTemp);\r\n\tif(beforeCommentId!=null){\r\n\t\tif(beforeReplyId!=null){\r\n\t\t\tcancelReply()\r\n\t\t}else{\r\n\t\t\tcancelComment()\r\n\t\t}\r\n\t\t\r\n\t}\r\n\tparentId=\"0\"\r\n\treplyInput.value='';\r\n\tbeforeCommentId=commentId\r\n\tcommentList.value.find(comment=>comment.commentDto.comment.id===commentId).isReply=true;\r\n\t// if(comment){\r\n\t// \tcomment.isReply=true;\r\n\t// }\r\n}\r\n\r\nfunction cancelComment(){\r\n\t\r\n\tcommentList.value.find(comment=>comment.commentDto.comment.id===beforeCommentId).isReply=false;\r\n\tbeforeCommentId=null;\r\n\t// commentList.value.find(comment=>comment.commentDto.comment.id===commentId).isReply=false;\r\n\r\n}\r\n\r\nfunction toReply(commentId,replyId){\r\n\treplyInput.value='';\r\n\tif(beforeCommentId!=null){\r\n\t\tif(beforeReplyId!=null){\r\n\t\t\tcancelReply()\r\n\t\t}else{\r\n\t\t\tcancelComment()\r\n\t\t}\r\n\t\t\r\n\t}\r\n\tparentId=replyId;\r\n\tbeforeCommentId=commentId;\r\n\tbeforeReplyId=replyId;\r\n\tcommentList.value.find(comment=>comment.commentDto.comment.id===commentId).replyDtoList.find(replyDto=>replyDto.reply.id===replyId).isReply=true;\r\n\r\n}\r\n\r\nfunction cancelReply(){\r\n\r\n\t// commentList.value.find(comment=>comment.commentDto.comment.id===commentId).replyDtoList.find(replyDto=>replyDto.reply.id===replyId).isReply=false;\r\n\tcommentList.value.find(comment=>comment.commentDto.comment.id===beforeCommentId).replyDtoList.find(replyDto=>replyDto.reply.id===beforeReplyId).isReply=false;\r\n\tbeforeReplyId=null;\r\n\tbeforeCommentId=null;\r\n}\r\nfunction setComment(){\r\n\tlet co = {\r\n\t\t\"articleId\":articleId,\r\n\t\t\"userId\":userInfo.id,\r\n\t\t\"content\":commentInput.value\r\n\t}\r\n\taddComment(co)\r\n\t.then(res=>{\r\n\t\tElMessage({\r\n\t\t\tmessage: '评论成功',\r\n\t\t\ttype: 'success',\r\n\t\t})\r\n\t\tgetComments(1,5);\r\n\t})\r\n}\r\n\r\nfunction setReply(commentId){\r\n\tlet re = {\r\n\t\t\"commentId\":commentId,\r\n\t\t\"userId\":userInfo.id,\r\n\t\t\"parentId\":parentId,\r\n\t\t\"content\":replyInput.value\r\n\t}\r\n\taddReply(re)\r\n\t.then(res=>{\r\n\t\tElMessage({\r\n\t\t\tmessage: '评论成功',\r\n\t\t\ttype: 'success',\r\n\t\t})\r\n\t\tgetComments(1,5);\r\n\t})\r\n}\r\n</script>\r\n\r\n\r\n<style src=\"@/assets/css/comment.css\" scoped>\r\n\r\n</style>","import script from \"./Index.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./Index.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"@/assets/css/comment.css?vue&type=style&index=0&id=56b7c2be&scoped=true&lang=css&external\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-56b7c2be\"]])\n\nexport default __exports__","<template>\r\n\t<div class=\"blog-body\">\r\n\t\t<div class=\"blog-left\">\r\n\t\t\t<div class=\"blog-catalog\">\r\n\t\t\t\t<div class=\"blog-catalog-head\">\r\n\t\t\t\t\t<img src=\"@/assets/imgs/目录2.svg\">\r\n\t\t\t\t\t<h1>目录</h1>\r\n\t\t\t\t\t<div class=\"blog-catalog-progress\">{{ progress }}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"blog-catalog-main\">\r\n\t\t\t\t\t<div class=\"blog-catalog-for\"\r\n\t\t\t\t\t\t\t\tv-for=\"(catalog, index) in catalogs\"\r\n\t\t\t\t\t\t\t\t:key=\"index\">\r\n\t\t\t\t\t\t<div class=\"blog-catalog-margin\" :style=\"{ marginLeft: catalog.level * 15 + 'px'}\"></div>\r\n\t\t\t\t\t\t<div class=\"blog-catalog-line\"></div>\r\n\t\t\t\t\t\t<span @click=\"scrollTo(catalog.id)\" :style=\"{backgroundImage:catalog.color}\" style=\"transition: 0.3s;\">{{ catalog.title }}</span>\r\n\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"blog-center\">\r\n\t\t\t<h1 class=\"blog-title\">{{ article.title }}</h1>\r\n\t\t\t<div id=\"vditor\" class=\"blog-content\" ></div>\r\n\t\t\t<div class=\"blog-comment\"><Comment></Comment></div>\r\n\t\t</div>\r\n\t\t<div class=\"blog-right\">\r\n\t\t\t<div class=\"blog-user\">\r\n\t\t\t\t<div class=\"blog-user-basic\">\r\n\t\t\t\t\t<img v-if=\"authorInfo!=null\" :src=\"imgDownload+authorInfo.avatar\" style=\"height: 50px;\">\r\n\t\t\t\t\t<span style=\"margin-top:10px\">{{ adminInfo.name }}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"blog-user-link\">\r\n\t\t\t\t\t<div class=\"blog-user-link-item\">\r\n\t\t\t\t\t\t<img src=\"../../assets/imgs/微信.svg\">\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"blog-user-link-item\">\r\n\t\t\t\t\t\t<img src=\"../../assets/imgs/QQ.svg\">\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"blog-user-link-item\">\r\n\t\t\t\t\t\t<img src=\"../../assets/imgs/github.svg\">\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"blog-user-link-item\">\r\n\t\t\t\t\t\t<img src=\"../../assets/imgs/邮箱.svg\">\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"blog-data\">\r\n\t\t\t\t\t<div class=\"blog-data-item\">\r\n\t\t\t\t\t\t<el-icon><View /></el-icon>\r\n\t\t\t\t\t\t<span>1</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"blog-data-item\">\r\n\t\t\t\t\t\t<el-icon><Pointer /></el-icon>\r\n\t\t\t\t\t\t<span>1</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"blog-data-item\">\r\n\t\t\t\t\t\t<el-icon><Star /></el-icon>\r\n\t\t\t\t\t\t<span>1</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"blog-data-item\">\r\n\t\t\t\t\t\t<el-icon><ChatLineSquare /></el-icon>\r\n\t\t\t\t\t\t<span>1</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"blog-tag\">\r\n\t\t\t\t<div class=\"blog-tag-head\">\r\n\t\t\t\t\t<img src=\"@/assets/imgs/标签2.svg\">\r\n\t\t\t\t\t<h1>标签</h1>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"blog-tag-main\">\r\n\t\t\t\t\t<div class=\"blog-tag-for\"\r\n\t\t\t\t\t\t\t\tv-for=\"(tag, index) in articleTagList\"\r\n\t\t\t\t\t\t\t\t:key=\"index\">\r\n\t\t\t\t\t\t<span class=\"blog-tag-item\">{{ tag.name }}</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n// 1.1 引入Vditor 构造函数\r\nimport Vditor from 'vditor'\r\n// 1.2 引入样式\r\nimport 'vditor/dist/index.css';\r\nimport { ref, onMounted,onBeforeUnmount,inject } from 'vue';\r\nimport { useRoute } from 'vue-router';\r\nimport {getArticleOne} from '@/api/article.js'\r\nimport {getAdminUserInfo,download,getArticleUserInfo} from '@/api/user.js'\r\nimport Comment from '../comment/Index.vue'\r\n// import VditorPreview from 'vditor/dist/method.min.js';\r\n// 2. 获取DOM引用\r\nconst route = useRoute();\r\nconst progress = ref(0);\r\nconst vditor = ref();\r\nconst imgDownload = inject('globalImgDownload');\r\n\r\nlet articleId=null;\r\nlet articleTagList = ref([]);\r\nlet catalogs = ref([])\r\nlet tags = ref([]);\r\nlet article=ref({\r\n  \"id\": null,\r\n  \"userId\": \"1\",\r\n  \"title\": \"\",\r\n  \"content\": \"\",\r\n  \"published\": null,\r\n  \"likeNum\": null,\r\n  \"collectNum\": null,\r\n  \"viewNum\":null,\r\n  \"commentNum\": null,\r\n  \"createTime\": null,\r\n  \"updateTime\": null\r\n})\r\nlet adminInfo=ref({\r\n\t\"name\":null,\r\n\t\"birthday\":null,\r\n\t\"avatar\":null,\r\n\t\"sex\":null,\r\n\t\"location\":null,\r\n\t\"college\":null\r\n});\r\nlet authorInfo=ref(null)\r\nlet avatar=ref()\r\nlet isLogin=ref(false);\r\nif(route.query.articleId != null){\r\n  // console.log(route.query.article)\r\n  articleId=route.query.articleId\r\n  // console.log(article);\r\n}\r\n// 3. 在组件初始化时，就创建Vditor对象，并引用\r\nonMounted(() => {\r\n\t\r\n\tgetAdmin();\r\n\tif(articleId != null)\r\n\tgetArticle()\r\n\twindow.addEventListener(\"scroll\", handleScroll,true);\r\n\t\r\n\r\n})\r\nonBeforeUnmount(()=>{\r\n\twindow.removeEventListener(\"scroll\", handleScroll);\r\n})\r\n\r\nfunction handleScroll() {\r\n  let catalog = catalogs.value;\r\n\tlet i=catalogs.value.length-1;\r\n\tlet flag=0;\r\n\tfor(i;i>=0;i--){\r\n\t\tif(catalog[i].scrollTop<=window.scrollY && flag==0){\r\n\t\t\tprogress.value=parseInt(\r\n\t\t\t\t\t\t\t\t\t(window.scrollY / document.documentElement.scrollHeight) *\r\n\t\t\t\t\t\t\t\t\t\t\t100\r\n\t\t\t\t\t\t\t) + \"%\";\r\n\t\t\tflag=1;\r\n\t\t\tcatalog[i].color=\"linear-gradient(to top,#f1214e,#6989e0,#43c6ee,#7ff121)\";\r\n\t\t}else{\r\n\t\t\tcatalog[i].color=\"linear-gradient(to right, #0e0d0d, #020202)\";\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\nfunction downloadAvatar(){\r\n\tdownload(adminInfo.value.avatar)\r\n\t.then(res=>{\r\n\t\t// const blob = new Blob([res.data]);\r\n\t\tconst reader = new FileReader();\r\n\t\treader.readAsDataURL(res);\r\n\t\treader.onload = () => {\r\n\t\t\tavatar.value = reader.result;\r\n\t\t};\r\n\t\t// avatar.value=res;\r\n\t})\r\n}\r\n\r\nfunction getAdmin(){\r\n  \r\n  getAdminUserInfo()\r\n  .then(res=>{\r\n    adminInfo.value=res.data\r\n    // adminName=adminInfo.value.name\r\n    // downloadAvatar()\r\n  })\r\n}\r\n\r\nfunction getArticleUser(){\r\n\r\n\tgetArticleUserInfo(article.value.userId)\r\n\t\t.then(res=>{\r\n\t\t\tauthorInfo.value=res.data;\r\n\t\t})\r\n}\r\n\r\n\r\n// //获取所有tag\r\n// function getTags () {\r\n//   getTagList()\r\n//     .then(res => {\r\n//       tags.value = res.data;\r\n      \r\n     \r\n//     })\r\n// }\r\n\r\n//获取文章\r\nfunction getArticle(){\r\n  \r\n  if(articleId!=null)\r\n    getArticleOne(articleId)\r\n    .then(res=>{\r\n     \r\n      articleTagList.value=res.data.tagList;\r\n      \r\n      article.value=res.data.article;\r\n\t\t\tconst vditorSpan = document.getElementById(\"vditor\");\r\n\t\t\tVditor.preview(vditorSpan,article.value.content,{\r\n\t\t\t\thljs:{style:\"manni\"},\r\n\t\t\t\tafter(){\r\n\t\t\t\t\tgetCatalog();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tgetArticleUser();\r\n\t\t\t\r\n     \r\n    })\r\n  \r\n}\r\n\r\n//生成目录\r\nfunction getCatalog () {\r\n  let ma = document.getElementById(\"vditor\");\r\n\tconst titleTag = [\"H1\", \"H2\", \"H3\", \"H4\", \"H5\", \"H6\"];\r\n\tlet titles=[];\r\n\tlet pre = 1;\r\n  let now = 0;\r\n  let count = 1;\r\n  let num = 0;\r\n\tlet parent=1;\r\n  ma.childNodes.forEach((e, index) => {\r\n    if (titleTag.includes(e.nodeName)) {\r\n      // const id = ids[num++];\r\n\t\t\tlet id = 'ma-' + index;\r\n\t\t\tma.childNodes[index].id = id\r\n      now = Number(e.nodeName.substring(1, 2));\r\n      // if (pre > now) {\r\n      //   count=parent;\r\n\t\t\t// \tparent=now;\r\n      // } else if (pre < now) {\r\n      //   count++;\r\n      // }\r\n      // pre = now;\r\n      titles.push({\r\n        id: id,\r\n        title: e.innerHTML,\r\n        level: now,\r\n        nodeName: e.nodeName,\r\n\t\t\t\tscrollTop: e.offsetTop,\r\n\t\t\t\tcolor:\"linear-gradient(to right, #0e0d0d, #020202)\"\r\n      });\r\n    }\r\n  });\r\n\tcatalogs.value=titles;\r\n\t\r\n\t\r\n}\r\n\r\n//点击目录，自动追寻文章相应位置\r\nfunction scrollTo (sectionId) {\r\n\r\n  const element = document.getElementById(sectionId);\r\n  if (element) {\r\n    console.log(sectionId)\r\n    element.scrollIntoView({ behavior: 'instant' });\r\n  }\r\n}\r\n\r\n</script>\r\n\r\n\r\n\r\n<style src=\"../../assets/css/blog.css\" scoped>\r\n\r\n</style>","import script from \"./Index.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./Index.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"../../assets/css/blog.css?vue&type=style&index=0&id=2d3ca9ba&scoped=true&lang=css&external\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-2d3ca9ba\"]])\n\nexport default __exports__"],"names":["login","user","request","url","method","data","save","download","filePath","params","responseType","getUserInfo","getAdminUserInfo","getArticleUserInfo","articleId","getCommentList","pageNumber","pageSize","addComment","comment","addReply","reply","ref","route","useRoute","query","commentList","total","userInfo","JSON","parse","localStorage","getItem","isLogin","beforeCommentId","beforeReplyId","commentInput","replyInput","parentId","imgDownload","inject","getComments","then","res","value","records","forEach","Object","assign","isReply","replyDtoList","findParentUserName","parentComment","find","replyDto","id","userName","toComment","commentId","cancelReply","cancelComment","commentDto","toReply","replyId","setComment","co","ElMessage","message","type","setReply","re","onMounted","__exports__","progress","articleTagList","catalogs","article","adminInfo","authorInfo","handleScroll","catalog","i","length","flag","scrollTop","window","scrollY","parseInt","document","documentElement","scrollHeight","color","getAdmin","getArticleUser","userId","getArticle","getArticleOne","tagList","vditorSpan","getElementById","Vditor","content","hljs","style","after","getCatalog","ma","titleTag","titles","now","childNodes","e","index","includes","nodeName","Number","substring","push","title","innerHTML","level","offsetTop","scrollTo","sectionId","element","console","log","scrollIntoView","behavior","addEventListener","onBeforeUnmount","removeEventListener"],"sourceRoot":""}
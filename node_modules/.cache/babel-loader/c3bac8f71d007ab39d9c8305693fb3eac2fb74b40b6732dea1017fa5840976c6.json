{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport Vditor from 'vditor';\n// 1.2 引入样式\nimport 'vditor/dist/index.css';\nimport { ref, onMounted } from 'vue';\nimport { useRoute } from 'vue-router';\nimport { getArticleOne } from '@/api/article.js';\n// import VditorPreview from 'vditor/dist/method.min.js';\n// 2. 获取DOM引用\n\nexport default {\n  __name: 'Index',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n\n    // 1.1 引入Vditor 构造函数\n    const route = useRoute();\n    const vditor = ref();\n    let articleId = null;\n    let articleTagList = ref([]);\n    let catalogs = ref([]);\n    let article = ref({\n      \"id\": null,\n      \"userId\": \"1\",\n      \"title\": \"\",\n      \"content\": \"\",\n      \"published\": null,\n      \"likeNum\": null,\n      \"collectNum\": null,\n      \"viewNum\": null,\n      \"commentNum\": null,\n      \"createTime\": null,\n      \"updateTime\": null\n    });\n    if (route.query.articleId != null) {\n      // console.log(route.query.article)\n      articleId = route.query.articleId;\n      // console.log(article);\n    }\n    // 3. 在组件初始化时，就创建Vditor对象，并引用\n    onMounted(() => {\n      if (articleId != null) getArticle();\n    });\n    function isSelected(tagId) {\n      for (let tagOne of articleTagList.value) {\n        if (tagOne.id == tagId) {\n          return true;\n        }\n      }\n      return false;\n    }\n\n    //获取文章\n    function getArticle() {\n      if (articleId != null) getArticleOne(articleId).then(res => {\n        articleTagList.value = res.data.tagList;\n        article.value = res.data.article;\n        const vditorSpan = document.getElementById(\"vditor\");\n        Vditor.preview(vditorSpan, article.value.content, {\n          hljs: {\n            style: \"github\"\n          }\n        });\n      });\n    }\n\n    //生成目录\n    function getCatalog() {\n      //给标题附上id\n      const vditorModel = vditor.value.getCurrentMode();\n      const article_contents = document.getElementsByClassName(\"vditor-reset\");\n      const titleTag = [\"H1\", \"H2\", \"H3\", \"H4\", \"H5\", \"H6\"];\n      let article_content = null;\n      let article_content2 = null;\n      let model = 'ir';\n      article_content = article_contents[2];\n      if (vditorModel === 'wysiwyg') {\n        article_content2 = article_contents[0];\n        model = 'wysiwyg';\n      } else if (vditorModel === 'sv') {\n        article_content2 = article_contents[1];\n        model = 'sv';\n      } else if (vditorModel === 'ir') {\n        article_content2 = article_contents[2];\n        model = 'ir';\n      }\n      // console.log(article_content)\n      let i = 0;\n      let ids = [];\n      article_content.childNodes.forEach((e, index) => {\n        // console.log(e);\n        // console.log(article_content2.childNodes[index]);\n        if (titleTag.includes(e.nodeName)) {\n          const id = model + \"-\" + index;\n          ids.push(id);\n          article_content2.childNodes[index].id = id;\n        }\n      });\n\n      //根据HTML内容，生成树\n      const article_content1 = new DOMParser().parseFromString(vditor.value.getHTML(), \"text/html\");\n      const titleTag1 = [\"H1\", \"H2\", \"H3\", \"H4\", \"H5\", \"H6\"];\n      let titles = [];\n      // 将childNodes转换为数组\n      const childNodesArray = Array.from(article_content1.body.childNodes);\n      let pre = 1;\n      let now = 0;\n      let count = 1;\n      let num = 0;\n      childNodesArray.forEach((e, index) => {\n        if (titleTag.includes(e.nodeName)) {\n          const id = ids[num++];\n          now = Number(e.nodeName.substring(1, 2));\n          if (pre > now) {\n            count = pre - now;\n          } else if (pre < now) {\n            count++;\n          }\n          pre = now;\n          console.log(count);\n          titles.push({\n            id: id,\n            title: e.innerHTML,\n            level: count,\n            nodeName: e.nodeName\n          });\n        }\n      });\n      catalogs.value = titles;\n    }\n    //点击目录，自动追寻文章相应位置\n    function scrollTo(sectionId) {\n      const element = document.getElementById(sectionId);\n      if (element) {\n        console.log(sectionId);\n        element.scrollIntoView({\n          behavior: 'instant'\n        });\n      }\n    }\n    const __returned__ = {\n      route,\n      vditor,\n      get articleId() {\n        return articleId;\n      },\n      set articleId(v) {\n        articleId = v;\n      },\n      get articleTagList() {\n        return articleTagList;\n      },\n      set articleTagList(v) {\n        articleTagList = v;\n      },\n      get catalogs() {\n        return catalogs;\n      },\n      set catalogs(v) {\n        catalogs = v;\n      },\n      get article() {\n        return article;\n      },\n      set article(v) {\n        article = v;\n      },\n      isSelected,\n      getArticle,\n      getCatalog,\n      scrollTo,\n      get Vditor() {\n        return Vditor;\n      },\n      ref,\n      onMounted,\n      get useRoute() {\n        return useRoute;\n      },\n      get getArticleOne() {\n        return getArticleOne;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["Vditor","ref","onMounted","useRoute","getArticleOne","route","vditor","articleId","articleTagList","catalogs","article","query","getArticle","isSelected","tagId","tagOne","value","id","then","res","data","tagList","vditorSpan","document","getElementById","preview","content","hljs","style","getCatalog","vditorModel","getCurrentMode","article_contents","getElementsByClassName","titleTag","article_content","article_content2","model","i","ids","childNodes","forEach","e","index","includes","nodeName","push","article_content1","DOMParser","parseFromString","getHTML","titleTag1","titles","childNodesArray","Array","from","body","pre","now","count","num","Number","substring","console","log","title","innerHTML","level","scrollTo","sectionId","element","scrollIntoView","behavior"],"sources":["E:/java项目/test/blog/blog-front/src/views/blog/Index.vue"],"sourcesContent":["<template>\r\n\t<div class=\"blog-body\">\r\n\t\t<div class=\"blog-left\">\r\n\t\t\t<div class=\"blog-catalog\">\r\n\t\t\t\t<div class=\"blog-catalog-head\">\r\n\t\t\t\t\t<img src=\"@/assets/imgs/目录2.svg\">\r\n\t\t\t\t\t<h1>目录</h1>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"blog-catalog-main\">\r\n\t\t\t\t\t<div class=\"blog-catalog-for\"\r\n\t\t\t\t\t\t\t\tv-for=\"(catalog, index) in catalogs\"\r\n\t\t\t\t\t\t\t\t:key=\"index\">\r\n\t\t\t\t\t\t<span :id=\"catalog.id\"\r\n\t\t\t\t\t\t\t\t\t:style=\"{ marginLeft: catalog.level * 20 + 'px'}\"\r\n\t\t\t\t\t\t\t\t\t@click=\"scrollTo(catalog.id)\">{{ catalog.title }}</span>\r\n\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"blog-center\">\r\n\t\t\t<h1 class=\"blog-title\">{{ article.title }}</h1>\r\n\t\t\t<div id=\"vditor\" class=\"blog-content\"></div>\r\n\t\t\t<div class=\"blog-comment\">评论</div>\r\n\t\t</div>\r\n\t\t<div class=\"blog-right\">\r\n\t\t\t<div class=\"blog-user\">\r\n\t\t\t\t<div class=\"blog-user-basic\">\r\n\t\t\t\t\t<img src=\"@/assets/imgs/fufu.jpg\" style=\"height: 50px;\">\r\n\t\t\t\t\t<span>作者</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"blog-user-link\">\r\n\t\t\t\t\t<div class=\"blog-user-link-item\">\r\n\t\t\t\t\t\t<img src=\"../../assets/imgs/微信.svg\">\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"blog-user-link-item\">\r\n\t\t\t\t\t\t<img src=\"../../assets/imgs/QQ.svg\">\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"blog-user-link-item\">\r\n\t\t\t\t\t\t<img src=\"../../assets/imgs/github.svg\">\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"blog-user-link-item\">\r\n\t\t\t\t\t\t<img src=\"../../assets/imgs/邮箱.svg\">\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"blog-data\">\r\n\t\t\t\t\t<div class=\"blog-data-item\">\r\n\t\t\t\t\t\t<el-icon><View /></el-icon>\r\n\t\t\t\t\t\t<span>1</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"blog-data-item\">\r\n\t\t\t\t\t\t<el-icon><Pointer /></el-icon>\r\n\t\t\t\t\t\t<span>1</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"blog-data-item\">\r\n\t\t\t\t\t\t<el-icon><Star /></el-icon>\r\n\t\t\t\t\t\t<span>1</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"blog-data-item\">\r\n\t\t\t\t\t\t<el-icon><ChatLineSquare /></el-icon>\r\n\t\t\t\t\t\t<span>1</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"blog-tag\">\r\n\t\t\t\t<div class=\"blog-tag-head\">\r\n\t\t\t\t\t<img src=\"@/assets/imgs/标签2.svg\">\r\n\t\t\t\t\t<h1>标签</h1>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n// 1.1 引入Vditor 构造函数\r\nimport Vditor from 'vditor'\r\n// 1.2 引入样式\r\nimport 'vditor/dist/index.css';\r\nimport { ref, onMounted } from 'vue';\r\nimport { useRoute } from 'vue-router';\r\nimport {getArticleOne} from '@/api/article.js'\r\n// import VditorPreview from 'vditor/dist/method.min.js';\r\n// 2. 获取DOM引用\r\nconst route = useRoute();\r\nconst vditor = ref()\r\nlet articleId=null;\r\nlet articleTagList = ref([]);\r\nlet catalogs = ref([])\r\nlet article=ref({\r\n  \"id\": null,\r\n  \"userId\": \"1\",\r\n  \"title\": \"\",\r\n  \"content\": \"\",\r\n  \"published\": null,\r\n  \"likeNum\": null,\r\n  \"collectNum\": null,\r\n  \"viewNum\":null,\r\n  \"commentNum\": null,\r\n  \"createTime\": null,\r\n  \"updateTime\": null\r\n})\r\nif(route.query.articleId != null){\r\n  // console.log(route.query.article)\r\n  articleId=route.query.articleId\r\n  // console.log(article);\r\n}\r\n// 3. 在组件初始化时，就创建Vditor对象，并引用\r\nonMounted(() => {\r\n\tif(articleId != null)\r\n\tgetArticle()\r\n})\r\n\r\nfunction isSelected(tagId) {\r\n  for(let tagOne of articleTagList.value){\r\n    if(tagOne.id==tagId){\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n//获取文章\r\nfunction getArticle(){\r\n  \r\n  if(articleId!=null)\r\n    getArticleOne(articleId)\r\n    .then(res=>{\r\n     \r\n      articleTagList.value=res.data.tagList;\r\n      \r\n      article.value=res.data.article;\r\n\t\t\tconst vditorSpan = document.getElementById(\"vditor\");\r\n\t\t\tVditor.preview(vditorSpan,article.value.content,{\r\n\t\t\t\thljs:{style:\"github\"},\r\n\t\t\t});\r\n     \r\n    })\r\n  \r\n}\r\n\r\n//生成目录\r\nfunction getCatalog () {\r\n  //给标题附上id\r\n  const vditorModel = vditor.value.getCurrentMode();\r\n\r\n  const article_contents = document.getElementsByClassName(\"vditor-reset\");\r\n  const titleTag = [\"H1\", \"H2\", \"H3\", \"H4\", \"H5\", \"H6\"];\r\n  let article_content = null;\r\n  let article_content2 = null;\r\n  let model = 'ir';\r\n  article_content = article_contents[2];\r\n  if (vditorModel === 'wysiwyg') {\r\n    article_content2 = article_contents[0];\r\n    model = 'wysiwyg';\r\n  } else if (vditorModel === 'sv') {\r\n    article_content2 = article_contents[1];\r\n    model = 'sv';\r\n  } else if (vditorModel === 'ir') {\r\n    article_content2 = article_contents[2];\r\n    model = 'ir';\r\n  }\r\n  // console.log(article_content)\r\n  let i = 0;\r\n  let ids = []\r\n  article_content.childNodes.forEach((e, index) => {\r\n    // console.log(e);\r\n    // console.log(article_content2.childNodes[index]);\r\n    if (titleTag.includes(e.nodeName)) {\r\n      const id = model + \"-\" + index;\r\n      ids.push(id)\r\n\r\n      article_content2.childNodes[index].id = id\r\n    }\r\n  })\r\n\r\n  //根据HTML内容，生成树\r\n  const article_content1 = new DOMParser().parseFromString(vditor.value.getHTML(), \"text/html\");\r\n  const titleTag1 = [\"H1\", \"H2\", \"H3\", \"H4\", \"H5\", \"H6\"];\r\n\r\n  let titles = [];\r\n  // 将childNodes转换为数组\r\n  const childNodesArray = Array.from(article_content1.body.childNodes);\r\n  let pre = 1;\r\n  let now = 0;\r\n  let count = 1;\r\n  let num = 0;\r\n  childNodesArray.forEach((e, index) => {\r\n    if (titleTag.includes(e.nodeName)) {\r\n      const id = ids[num++];\r\n      now = Number(e.nodeName.substring(1, 2));\r\n      if (pre > now) {\r\n        count=pre-now;\r\n      } else if (pre < now) {\r\n        count++;\r\n      }\r\n      pre = now;\r\n      console.log(count)\r\n      titles.push({\r\n        id: id,\r\n        title: e.innerHTML,\r\n        level: count,\r\n        nodeName: e.nodeName\r\n      });\r\n    }\r\n  });\r\n\r\n  catalogs.value = titles;\r\n\r\n\r\n\r\n}\r\n//点击目录，自动追寻文章相应位置\r\nfunction scrollTo (sectionId) {\r\n\r\n  const element = document.getElementById(sectionId);\r\n  if (element) {\r\n    console.log(sectionId)\r\n    element.scrollIntoView({ behavior: 'instant' });\r\n  }\r\n}\r\n\r\n</script>\r\n\r\n\r\n\r\n<style src=\"../../assets/css/blog.css\" scoped>\r\n\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
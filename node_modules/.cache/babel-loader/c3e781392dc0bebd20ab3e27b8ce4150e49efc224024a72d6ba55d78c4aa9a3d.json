{"ast":null,"code":"import { ref, onMounted, inject } from 'vue';\nimport { getCommentList } from '@/api/comment.js';\nimport { useRoute } from 'vue-router';\nexport default {\n  __name: 'Index',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    let isReply = ref(false);\n    const route = useRoute();\n    let articleId = route.query.articleId;\n    let commentListTemp = null;\n    let commentList = ref(null);\n    let total = ref(0);\n    let userInfo = JSON.parse(localStorage.getItem(\"userInfo\"));\n    let isLogin = ref(false);\n    let beforeCommentId = null;\n    let beforeReplyId = null;\n    const imgDownload = inject('globalImgDownload');\n    onMounted(() => {\n      getComments(1, 5);\n      if (userInfo != null) {\n        isLogin.value = true;\n        console.log(userInfo);\n      }\n    });\n    function getComments(pageNumber, pageSize) {\n      getCommentList(articleId, pageNumber, pageSize).then(res => {\n        if (res.data == null) {\n          return;\n        }\n        total.value = res.data.total;\n        commentList.value = res.data.records;\n        commentList.value.forEach(comment => {\n          //为每个对象添加新属性\n          Object.assign(comment, {\n            isReply: false\n          });\n          // 如果replyDtoList不为null，则为每个对象添加新属性\n          if (comment.replyDtoList) {\n            comment.replyDtoList.forEach(reply => {\n              Object.assign(reply, {\n                isReply: false\n              });\n            });\n          }\n        });\n        // commentListTemp=[...commentList.value];\n      });\n    }\n    function findParentUserName(comment, parentId) {\n      const parentComment = comment.replyDtoList.find(replyDto => replyDto.reply.id === parentId);\n      return parentComment ? parentComment.userName : '';\n    }\n    function toComment(commentId) {\n      // commentList.value=commentListTemp;\n      // console.log(commentListTemp)\n      // commentList.value=Object.assign([], commentListTemp);\n      if (beforeCommentId != null) {\n        if (beforeReplyId != null) {\n          commentList.value.find(comment => comment.commentDto.comment.id === commentId).replyDtoList.find(replyDto => replyDto.reply.id === replyId).isReply = false;\n          beforeReplyId;\n        } else {\n          commentList.value.find(comment => comment.commentDto.comment.id === commentId).isReply = false;\n        }\n      }\n      commentList.value.find(comment => comment.commentDto.comment.id === commentId).isReply = true;\n      // if(comment){\n      // \tcomment.isReply=true;\n      // }\n    }\n    function cancelComment(commentId) {\n      // commentList.value=Object.assign([], commentListTemp);\n      commentList.value.find(comment => comment.commentDto.comment.id === commentId).isReply = false;\n      // const comment = commentList.value.find(comment=>comment.id===commentId);\n      // if(comment){\n      // \tcomment.isReply=false;\n      // }\n    }\n    function toReply(commentId, replyId) {\n      // commentList.value=[...commentListTemp];\n      // commentList.value=Object.assign([], commentListTemp);\n      commentList.value.find(comment => comment.commentDto.comment.id === commentId).replyDtoList.find(replyDto => replyDto.reply.id === replyId).isReply = true;\n      // if(comment){\n      // \tcomment.isReply=true;\n      // }\n    }\n    function cancelReply(commentId, replyId) {\n      // commentList.value=[...commentListTemp];\n      // commentList.value=Object.assign([], commentListTemp);\n      commentList.value.find(comment => comment.commentDto.comment.id === commentId).replyDtoList.find(replyDto => replyDto.reply.id === replyId).isReply = false;\n      // const comment = commentList.value.find(comment=>comment.id===commentId);\n      // if(comment){\n      // \tcomment.isReply=false;\n      // }\n    }\n    // function addComment(){\n\n    // }\n\n    // function addReply(commentId,){\n\n    // }\n\n    const __returned__ = {\n      get isReply() {\n        return isReply;\n      },\n      set isReply(v) {\n        isReply = v;\n      },\n      route,\n      get articleId() {\n        return articleId;\n      },\n      set articleId(v) {\n        articleId = v;\n      },\n      get commentListTemp() {\n        return commentListTemp;\n      },\n      set commentListTemp(v) {\n        commentListTemp = v;\n      },\n      get commentList() {\n        return commentList;\n      },\n      set commentList(v) {\n        commentList = v;\n      },\n      get total() {\n        return total;\n      },\n      set total(v) {\n        total = v;\n      },\n      get userInfo() {\n        return userInfo;\n      },\n      set userInfo(v) {\n        userInfo = v;\n      },\n      get isLogin() {\n        return isLogin;\n      },\n      set isLogin(v) {\n        isLogin = v;\n      },\n      get beforeCommentId() {\n        return beforeCommentId;\n      },\n      set beforeCommentId(v) {\n        beforeCommentId = v;\n      },\n      get beforeReplyId() {\n        return beforeReplyId;\n      },\n      set beforeReplyId(v) {\n        beforeReplyId = v;\n      },\n      imgDownload,\n      getComments,\n      findParentUserName,\n      toComment,\n      cancelComment,\n      toReply,\n      cancelReply,\n      ref,\n      onMounted,\n      inject,\n      get getCommentList() {\n        return getCommentList;\n      },\n      get useRoute() {\n        return useRoute;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","inject","getCommentList","useRoute","isReply","route","articleId","query","commentListTemp","commentList","total","userInfo","JSON","parse","localStorage","getItem","isLogin","beforeCommentId","beforeReplyId","imgDownload","getComments","value","console","log","pageNumber","pageSize","then","res","data","records","forEach","comment","Object","assign","replyDtoList","reply","findParentUserName","parentId","parentComment","find","replyDto","id","userName","toComment","commentId","commentDto","replyId","cancelComment","toReply","cancelReply"],"sources":["E:/java项目/blog/blog-front/src/views/comment/Index.vue"],"sourcesContent":["<template>\r\n\t<div class=\"comment-body\" v-if=\"isLogin\">\r\n\t\t<div class=\"comment-head\">\r\n\t\t\t<div class=\"comment-input\">\r\n\t\t\t\t<!-- <img class=\"comment-user-avatar\" src=\"@/assets/imgs/fufu.jpg\" style=\"margin-right: 5px;\"> -->\r\n\t\t\t\t<img class=\"comment-user-avatar\" :src=\"imgDownload + userInfo.avatar\" style=\"margin-right: 5px;\">\r\n\t\t\t\t<textarea ></textarea>\r\n\t\t\t\t<div class=\"comment-input-button\">评论</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"comment-main\">\r\n\t\t\t<div class=\"comment-for\" v-for=\"comment in commentList\" :key=\"comment.commentDto.comment.id\">\r\n\t\t\t\t<div class=\"comment\">\r\n\t\t\t\t\t<div class=\"comment-content\">\r\n\t\t\t\t\t\t<div class=\"comment-content-left\">\r\n\t\t\t\t\t\t\t<img class=\"comment-user-avatar\" :src=\"imgDownload + comment.commentDto.userAvatar\">\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"comment-content-right\">\r\n\t\t\t\t\t\t\t<div class=\"comment-user-name\">{{ comment.commentDto.userName }}</div>\r\n\t\t\t\t\t\t\t<div class=\"comment-time\">{{ comment.commentDto.comment.createTime }}</div>\r\n\t\t\t\t\t\t\t<div class=\"comment-text\">{{ comment.commentDto.comment.content }}</div>\r\n\t\t\t\t\t\t\t<div class=\"comment-info\">\r\n\t\t\t\t\t\t\t\t<div class=\"comment-info-item\" v-if=\"!comment.isReply\" @click=\"toComment(comment.commentDto.comment.id)\">\r\n\t\t\t\t\t\t\t\t\t<img src=\"@/assets/imgs/blog/评论.svg\">\r\n\t\t\t\t\t\t\t\t\t<span>回复</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"comment-info-item\" v-else @click=\"cancelComment(comment.commentDto.comment.id)\">\r\n\t\t\t\t\t\t\t\t\t<img src=\"@/assets/imgs/blog/评论.svg\">\r\n\t\t\t\t\t\t\t\t\t<span>收起</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"comment-info-item\">\r\n\t\t\t\t\t\t\t\t\t<span>1</span>\r\n\t\t\t\t\t\t\t\t\t<img src=\"@/assets/imgs/blog/点赞.svg\">\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"comment-input\" style=\"width: 90%;\" v-if=\"comment.isReply\">\r\n\t\t\t\t\t\t<textarea style=\"height: 120px;\"></textarea>\r\n\t\t\t\t\t\t<div class=\"comment-input-button\">评论</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"comment-item-for\"  v-for=\"replyDto in comment.replyDtoList\" :key=\"replyDto.reply.id\">\r\n\t\t\t\t\t\t<div class=\"comment-content\">\r\n\t\t\t\t\t\t\t<div class=\"comment-content-left\">\r\n\t\t\t\t\t\t\t\t<img class=\"comment-user-avatar\" :src=\"imgDownload + replyDto.userAvatar\">\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"comment-content-right\">\r\n\t\t\t\t\t\t\t\t<div class=\"comment-user-name\">{{replyDto.userName}}</div>\r\n\t\t\t\t\t\t\t\t<div class=\"comment-time\">{{ replyDto.reply.createTime }}</div>\r\n\t\t\t\t\t\t\t\t<div class=\"comment-text\">\r\n\t\t\t\t\t\t\t\t\t<div v-if=\"replyDto.reply.parentId!='0'\">回复<span>{{ findParentUserName(comment, replyDto.reply.parentId) }}：</span></div>\r\n\t\t\t\t\t\t\t\t\t<div>{{ replyDto.reply.content }}</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"comment-info\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"comment-info-item\" v-if=\"!replyDto.isReply\" @click=\"toReply(comment.commentDto.comment.id,replyDto.reply.id)\">\r\n\t\t\t\t\t\t\t\t\t\t<img src=\"@/assets/imgs/blog/评论.svg\">\r\n\t\t\t\t\t\t\t\t\t\t<span>回复</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"comment-info-item\" v-else @click=\"cancelReply(comment.commentDto.comment.id,replyDto.reply.id)\">\r\n\t\t\t\t\t\t\t\t\t\t<img src=\"@/assets/imgs/blog/评论.svg\">\r\n\t\t\t\t\t\t\t\t\t\t<span>收起</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"comment-info-item\">\r\n\t\t\t\t\t\t\t\t\t\t<span>1</span>\r\n\t\t\t\t\t\t\t\t\t\t<img src=\"@/assets/imgs/blog/点赞.svg\">\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"comment-input\" style=\"width: 90%;\" v-if=\"replyDto.isReply\">\r\n\t\t\t\t\t\t\t<textarea style=\"height: 120px;\"></textarea>\r\n\t\t\t\t\t\t\t<div class=\"comment-input-button\">评论</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\nimport {ref,onMounted,inject} from 'vue'\r\nimport {getCommentList} from '@/api/comment.js'\r\nimport { useRoute } from 'vue-router';\r\nlet isReply = ref(false);\r\nconst route = useRoute();\r\nlet articleId=route.query.articleId;\r\nlet commentListTemp=null;\r\nlet commentList=ref(null);\r\nlet total = ref(0);\r\nlet userInfo = JSON.parse(localStorage.getItem(\"userInfo\"));\r\nlet isLogin=ref(false);\r\nlet beforeCommentId=null;\r\nlet beforeReplyId=null;\r\nconst imgDownload = inject('globalImgDownload');\r\nonMounted(()=>{\r\n\tgetComments(1,5);\r\n\tif(userInfo!=null){\r\n\t\tisLogin.value=true;\r\n\t\tconsole.log(userInfo);\r\n\t}\r\n})\r\n\r\nfunction getComments(pageNumber, pageSize){\r\n\tgetCommentList(articleId,pageNumber, pageSize)\r\n\t\t.then(res=>{\r\n\t\t\tif(res.data==null){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\ttotal.value=res.data.total;\r\n\t\t\tcommentList.value=res.data.records;\r\n\t\t\tcommentList.value.forEach(comment=>{\r\n\t\t\t\t//为每个对象添加新属性\r\n\t\t\t\tObject.assign(comment, { isReply: false });\r\n\t\t\t\t// 如果replyDtoList不为null，则为每个对象添加新属性\r\n\t\t\t\tif (comment.replyDtoList) {\r\n\t\t\t\t\tcomment.replyDtoList.forEach(reply => {\r\n\t\t\t\t\t\tObject.assign(reply, { isReply: false });\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t// commentListTemp=[...commentList.value];\r\n\t\t\t\r\n\t\t})\r\n}\r\n\r\nfunction findParentUserName(comment, parentId) {\r\n\tconst parentComment = comment.replyDtoList.find(replyDto => replyDto.reply.id === parentId);\r\n\treturn parentComment ? parentComment.userName : '';\r\n}\r\n\r\nfunction toComment(commentId){\r\n\t// commentList.value=commentListTemp;\r\n\t// console.log(commentListTemp)\r\n\t// commentList.value=Object.assign([], commentListTemp);\r\n\tif(beforeCommentId!=null){\r\n\t\tif(beforeReplyId!=null){\r\n\t\t\tcommentList.value.find(comment=>comment.commentDto.comment.id===commentId).replyDtoList.find(replyDto=>replyDto.reply.id===replyId).isReply=false;\r\n\t\t\tbeforeReplyId\r\n\t\t}else{\r\n\t\t\tcommentList.value.find(comment=>comment.commentDto.comment.id===commentId).isReply=false;\r\n\t\t}\r\n\t}\r\n\tcommentList.value.find(comment=>comment.commentDto.comment.id===commentId).isReply=true;\r\n\t// if(comment){\r\n\t// \tcomment.isReply=true;\r\n\t// }\r\n}\r\n\r\nfunction cancelComment(commentId){\r\n\t// commentList.value=Object.assign([], commentListTemp);\r\n\tcommentList.value.find(comment=>comment.commentDto.comment.id===commentId).isReply=false;\r\n\t// const comment = commentList.value.find(comment=>comment.id===commentId);\r\n\t// if(comment){\r\n\t// \tcomment.isReply=false;\r\n\t// }\r\n}\r\n\r\nfunction toReply(commentId,replyId){\r\n\t// commentList.value=[...commentListTemp];\r\n\t// commentList.value=Object.assign([], commentListTemp);\r\n\tcommentList.value.find(comment=>comment.commentDto.comment.id===commentId).replyDtoList.find(replyDto=>replyDto.reply.id===replyId).isReply=true;\r\n\t// if(comment){\r\n\t// \tcomment.isReply=true;\r\n\t// }\r\n}\r\n\r\nfunction cancelReply(commentId,replyId){\r\n\t// commentList.value=[...commentListTemp];\r\n\t// commentList.value=Object.assign([], commentListTemp);\r\n\tcommentList.value.find(comment=>comment.commentDto.comment.id===commentId).replyDtoList.find(replyDto=>replyDto.reply.id===replyId).isReply=false;\r\n\t// const comment = commentList.value.find(comment=>comment.id===commentId);\r\n\t// if(comment){\r\n\t// \tcomment.isReply=false;\r\n\t// }\r\n}\r\n// function addComment(){\r\n\r\n// }\r\n\r\n// function addReply(commentId,){\r\n\r\n// }\r\n</script>\r\n\r\n\r\n<style src=\"@/assets/css/comment.css\" scoped>\r\n\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}